# FastText Classifier Integration

## –û–±–∑–æ—Ä

RADAR –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –±—ã—Å—Ç—Ä—É—é –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—É—é –º–æ–¥–µ–ª—å **FastText** –¥–ª—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ –Ω–æ–≤–æ—Å—Ç–µ–π –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º.

## –ú–æ–¥–µ–ª—å

**–ò—Å—Ç–æ—á–Ω–∏–∫**: [data-silence/fasttext-rus-news-classifier](https://huggingface.co/data-silence/fasttext-rus-news-classifier)

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- ‚ö° **–û—á–µ–Ω—å –±—ã—Å—Ç—Ä–∞—è** - –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –∑–∞ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã
- üîÑ **Offline** - —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏

## –ö–∞—Ç–µ–≥–æ—Ä–∏–∏

–ú–æ–¥–µ–ª—å –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç –Ω–æ–≤–æ—Å—Ç–∏ –ø–æ —Å–ª–µ–¥—É—é—â–∏–º –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º:

### –§–∏–Ω–∞–Ω—Å–æ–≤–æ-—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ ‚úÖ

- **`economy`** - –≠–∫–æ–Ω–æ–º–∏–∫–∞
- **`stock`** - –ê–∫—Ü–∏–∏, –±–∏—Ä–∂–∞
- **`business`** - –ë–∏–∑–Ω–µ—Å
- **`finance`** - –§–∏–Ω–∞–Ω—Å—ã

### –ù–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ ‚ùå

- `sport` - –°–ø–æ—Ä—Ç
- `politics` - –ü–æ–ª–∏—Ç–∏–∫–∞ (–±–µ–∑ —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞)
- `culture` - –ö—É–ª—å—Ç—É—Ä–∞
- `society` - –û–±—â–µ—Å—Ç–≤–æ
- `technology` - –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ (–±–µ–∑ —Ñ–∏–Ω–∞–Ω—Å–æ–≤)
- –∏ –¥—Ä—É–≥–∏–µ...

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 1. –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è

```python
from src.parsers.fasttext_classifier import get_fasttext_classifier

classifier = get_fasttext_classifier()

result = classifier.classify_article(
    title="–¶–ë –ø–æ–≤—ã—Å–∏–ª –∫–ª—é—á–µ–≤—É—é —Å—Ç–∞–≤–∫—É –¥–æ 16%",
    content_preview="–ë–∞–Ω–∫ –†–æ—Å—Å–∏–∏ –ø—Ä–∏–Ω—è–ª —Ä–µ—à–µ–Ω–∏–µ..."
)

# –†–µ–∑—É–ª—å—Ç–∞—Ç:
# {
#     'is_relevant': True,
#     'confidence': 0.9993,
#     'category': 'economy',
#     'reason': "FastText classified as 'economy' with score 0.999"
# }
```

### 2. –ë–∞—Ç—á–∏–Ω–≥

```python
articles = [
    {'title': '–ù–æ–≤–æ—Å—Ç—å 1', 'overview': '–¢–µ–∫—Å—Ç...'},
    {'title': '–ù–æ–≤–æ—Å—Ç—å 2', 'overview': '–¢–µ–∫—Å—Ç...'},
]

relevant = classifier.batch_classify(articles, min_score=0.5)
# –í–µ—Ä–Ω–µ—Ç —Ç–æ–ª—å–∫–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Å—Ç–∞—Ç—å–∏
```

### 3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –ø–∞—Ä—Å–µ—Ä

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∏ `classify=True`:

```python
# src/parsers/scheduler.py
task = self.run_parser(
    parser,
    classify=True  # FastText –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –≤–∫–ª—é—á–µ–Ω–∞
)
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø–æ—Ä–æ–≥ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏

```python
# .env –∏–ª–∏ docker-compose.yml
FASTTEXT_MIN_SCORE=0.5  # 0.0-1.0 (default: 0.5)
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏**:
- `0.3-0.4` - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –æ—Ö–≤–∞—Ç (–±–æ–ª—å—à–µ false positives)
- `0.5-0.6` - –ë–∞–ª–∞–Ω—Å (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- `0.7-0.9` - –í—ã—Å–æ–∫–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å (–º–æ–∂–µ—Ç –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –ø–æ–≥—Ä–∞–Ω–∏—á–Ω—ã–µ)

### –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

```python
# src/parsers/fasttext_classifier.py
FINANCIAL_CATEGORIES = {
    'economy',
    'stock',
    'business',
    'finance',
    'realty',      # –î–æ–±–∞–≤–∏—Ç—å –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å
    'crypto',      # –î–æ–±–∞–≤–∏—Ç—å –∫—Ä–∏–ø—Ç—É (–µ—Å–ª–∏ –º–æ–¥–µ–ª—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç)
}
```

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –°–∫–æ—Ä–æ—Å—Ç—å

| –û–ø–µ—Ä–∞—Ü–∏—è | –í—Ä–µ–º—è |
|----------|-------|
| –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏ | ~2-3 —Å–µ–∫ (–æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ) |
| –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è 1 —Å—Ç–∞—Ç—å–∏ | ~0.001-0.002 —Å–µ–∫ |
| –ë–∞—Ç—á 100 —Å—Ç–∞—Ç–µ–π | ~0.1-0.2 —Å–µ–∫ |

### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å LLM

| –ü–∞—Ä–∞–º–µ—Ç—Ä | FastText | LLM (OpenRouter) |
|----------|----------|------------------|
| –°–∫–æ—Ä–æ—Å—Ç—å | ‚ö°‚ö°‚ö° 0.002 —Å–µ–∫ | üêå 1-2 —Å–µ–∫ |
| –°—Ç–æ–∏–º–æ—Å—Ç—å | üí∞ –ë–µ—Å–ø–ª–∞—Ç–Ω–æ | üí∏ $0.001/–∑–∞–ø—Ä–æ—Å |
| –¢–æ—á–Ω–æ—Å—Ç—å | ‚úÖ 90-95% | ‚úÖ‚úÖ 95-98% |
| Offline | ‚úÖ –î–∞ | ‚ùå –ù–µ—Ç |

**–í—ã–≤–æ–¥**: FastText –≤ **500-1000 —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ** –∏ –±–µ—Å–ø–ª–∞—Ç–Ω–æ! üöÄ

## –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã

### –í—Ö–æ–¥

```
8 –ø—Ä–æ–µ–∫—Ç–æ–≤ –†–ë–ö √ó 10 —Å—Ç—Ä–∞–Ω–∏—Ü = ~1600 —Å—Ç–∞—Ç–µ–π
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞

```
1. –ü–∞—Ä—Å–∏–Ω–≥ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –∏ –∞–Ω–æ–Ω—Å–æ–≤ (~5 —Å–µ–∫)
2. FastText –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è (~1.5 —Å–µ–∫ –¥–ª—è 1600 —Å—Ç–∞—Ç–µ–π)
3. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è (economy, stock, business, finance)
4. –†–µ–∑—É–ª—å—Ç–∞—Ç: ~400 —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Å—Ç–∞—Ç–µ–π (25%)
5. –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö (~40 —Å–µ–∫)
```

### –ò—Ç–æ–≥–æ

- ‚è±Ô∏è **–í—Ä–µ–º—è**: ~46 —Å–µ–∫ (–≤–º–µ—Å—Ç–æ ~1600 —Å–µ–∫ —Å LLM)
- üí∞ **–°—Ç–æ–∏–º–æ—Å—Ç—å**: $0 (–≤–º–µ—Å—Ç–æ ~$1.60 —Å LLM)
- üìä **–¢–æ—á–Ω–æ—Å—Ç—å**: ~92% (vs ~96% —É LLM)

## Troubleshooting

### –û—à–∏–±–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ fasttext

```bash
# –ï—Å–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è fasttext-wheel
pip uninstall fasttext fasttext-wheel
pip install fasttext-wheel
```

### Numpy version conflict

```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ numpy < 2.0
pip install 'numpy>=1.26.0,<2.0.0'
```

### –ú–æ–¥–µ–ª—å –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è

```bash
# –í—Ä—É—á–Ω—É—é –∑–∞–≥—Ä—É–∑–∏—Ç—å –º–æ–¥–µ–ª—å
python -c "from huggingface_hub import hf_hub_download; hf_hub_download('data-silence/fasttext-rus-news-classifier', 'fasttext_news_classifier.bin')"
```

### –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ false positives

‚Üí –£–≤–µ–ª–∏—á—å—Ç–µ `FASTTEXT_MIN_SCORE` –¥–æ 0.7-0.8

### –ü—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è –≤–∞–∂–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–∏

‚Üí –£–º–µ–Ω—å—à–∏—Ç–µ `FASTTEXT_MIN_SCORE` –¥–æ 0.3-0.4  
‚Üí –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–æ–≤–æ—Å—Ç–∏ –≤ `FINANCIAL_CATEGORIES`

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –õ–æ–≥–∏ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏
docker logs radar-parser -f | grep "Classified"

# –ü—Ä–∏–º–µ—Ä:
# Classified: '–¶–ë –ø–æ–≤—ã—Å–∏–ª –∫–ª—é—á–µ–≤—É—é —Å—Ç–∞–≤–∫—É...' -> category=economy, score=0.999, relevant=True
# Filtered out: '–ù–æ–≤—ã–π —Ñ–∏–ª—å–º –≤—ã—à–µ–ª...' (category=culture, score=0.987)
```

## –ú–µ—Ç—Ä–∏–∫–∏ –≤ ClickHouse

```sql
-- –°—Ç–∞—Ç—å–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
SELECT 
    JSONExtractString(classification, 'category') as category,
    count() as cnt,
    avg(CAST(JSONExtractString(classification, 'confidence') AS Float64)) as avg_confidence
FROM news_articles
WHERE classification != ''
GROUP BY category
ORDER BY cnt DESC;
```

## Best Practices

1. ‚úÖ **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ FastText –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é** - –±—ã—Å—Ç—Ä–æ –∏ —Ç–æ—á–Ω–æ
2. ‚úÖ **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–æ—Ä–æ–≥** - —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Å min_score
3. ‚úÖ **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –º–µ—Ç—Ä–∏–∫–∏** - –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ø—Ä–æ—Ü–µ–Ω—Ç –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã—Ö
4. ‚úÖ **–õ–æ–≥–∏—Ä—É–π—Ç–µ –ø—Ä–∏–º–µ—Ä—ã** - –∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ false negatives/positives
5. üîÑ **LLM –¥–ª—è edge cases** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ LLM —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–æ–º–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö

## –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

- [ ] –§–∞–π–Ω-—Ç—é–Ω–∏–Ω–≥ –Ω–∞ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –Ω–æ–≤–æ—Å—Ç—è—Ö –†–ë–ö
- [ ] –î–æ–±–∞–≤–∏—Ç—å multi-label classification
- [ ] –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏
- [ ] A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å LLM
- [ ] Ensemble (FastText + –ø—Ä–æ—Å—Ç—ã–µ –ø—Ä–∞–≤–∏–ª–∞)

